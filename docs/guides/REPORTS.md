# Reports Guide

This guide covers the various report formats generated by auto-image-diff and how to interpret them.

## Report Types

### 1. JSON Reports

Machine-readable format containing all comparison data.

#### Basic Report Structure

```json
{
  "comparison": {
    "reference": "baseline/home.png",
    "target": "current/home.png",
    "threshold": 0.1,
    "timestamp": "2025-01-15T10:00:00Z"
  },
  "results": {
    "difference": 0.065,
    "isEqual": true,
    "pixelsDifferent": 1250,
    "totalPixels": 1920000,
    "percentageDifferent": 0.065
  },
  "processing": {
    "alignmentMethod": "subimage",
    "processingTime": 523,
    "version": "1.0.0"
  }
}
```

#### Smart Classification Report

```json
{
  "summary": {
    "totalChanges": 12,
    "byType": {
      "content": 3,
      "style": 5,
      "layout": 3,
      "new_element": 1
    },
    "averageConfidence": 0.84,
    "severity": "moderate"
  },
  "changes": [
    {
      "id": "change_001",
      "type": "style",
      "confidence": 0.92,
      "severity": "minor",
      "bounds": {
        "x": 100,
        "y": 50,
        "width": 200,
        "height": 100
      },
      "details": {
        "properties": ["background-color", "border"],
        "description": "Button styling changed"
      }
    }
  ],
  "suggestions": {
    "exclusions": [
      {
        "bounds": { "x": 0, "y": 0, "width": 200, "height": 30 },
        "reason": "High variance region - likely dynamic content",
        "confidence": 0.85
      }
    ],
    "css": {
      "selector": ".button",
      "properties": {
        "background-color": "#0066cc",
        "border": "1px solid #0052a3"
      }
    }
  }
}
```

### 2. HTML Reports

Interactive web-based reports for visual analysis.

#### Features

- **Before/After Slider** - Interactive comparison view
- **Change Highlighting** - Visual markers on differences
- **Statistics Dashboard** - Key metrics at a glance
- **Change Timeline** - Processing steps visualization
- **Classification Breakdown** - Charts showing change types

#### Report Sections

1. **Summary Dashboard**

   ```html
   <!-- Key metrics -->
   - Total Difference: 2.34% - Changes Detected: 15 - Processing Time: 1.2s - Confidence Score: 87%
   ```

2. **Visual Comparison**
   - Side-by-side view
   - Overlay mode
   - Difference highlighting
   - Zoom and pan controls

3. **Change Analysis**
   - Change type breakdown
   - Confidence distribution
   - Severity assessment
   - Region details

4. **Recommendations**
   - Suggested exclusions
   - CSS fixes
   - Threshold adjustments

### 3. Batch Reports

Comprehensive reports for multiple comparisons.

#### Batch Summary Structure

```json
{
  "summary": {
    "totalFiles": 50,
    "processed": 50,
    "passed": 45,
    "failed": 5,
    "skipped": 0,
    "averageDifference": 0.23,
    "totalProcessingTime": 15.7
  },
  "results": [
    {
      "id": "comparison_001",
      "reference": "baseline/home.png",
      "target": "current/home.png",
      "status": "passed",
      "difference": 0.05,
      "processingTime": 0.31,
      "outputDir": "output/home"
    }
  ],
  "performance": {
    "startTime": "2025-01-15T10:00:00Z",
    "endTime": "2025-01-15T10:00:15Z",
    "throughput": 3.18,
    "peakMemory": 512,
    "averageMemory": 384,
    "concurrency": 4
  },
  "failures": [
    {
      "file": "current/checkout.png",
      "error": "Difference threshold exceeded",
      "difference": 5.23,
      "threshold": 0.5
    }
  ]
}
```

#### Batch HTML Report

Interactive dashboard with:

- Summary statistics
- Pass/fail breakdown
- Processing timeline
- Performance graphs
- Sortable results table
- Individual comparison links

## Report Generation

### CLI Commands

```bash
# Generate report from existing results
aid report comparison-results/

# Generate report with custom template
aid report results/ --template custom-template.html

# Generate JSON-only report
aid report results/ --format json

# Generate report with charts
aid report results/ --include-charts
```

### Programmatic Generation

```typescript
import { ReportGenerator } from "auto-image-diff";

const generator = new ReportGenerator();

// Generate HTML report
const htmlReport = await generator.generateHTML({
  results: comparisonResults,
  options: {
    includeCharts: true,
    includeTimeline: true,
    template: "default",
  },
});

// Generate JSON report
const jsonReport = await generator.generateJSON({
  results: comparisonResults,
  includeMetadata: true,
  prettyPrint: true,
});

// Custom report
const customReport = await generator.generate({
  results: comparisonResults,
  format: "html",
  customSections: [
    {
      title: "Custom Analysis",
      content: customAnalysisHTML,
    },
  ],
});
```

## Report Customization

### Custom Templates

Create custom HTML templates:

```html
<!-- custom-template.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>{{title}}</title>
    <style>
      /* Custom styles */
      .summary {
        /* ... */
      }
    </style>
  </head>
  <body>
    <h1>{{projectName}} Visual Regression Report</h1>

    <div class="summary">
      <h2>Summary</h2>
      <p>Total Comparisons: {{totalComparisons}}</p>
      <p>Failed: {{failedCount}}</p>
    </div>

    {{#each results}}
    <div class="comparison">
      <h3>{{this.name}}</h3>
      <p>Difference: {{this.difference}}%</p>
      <!-- Custom visualization -->
    </div>
    {{/each}}
  </body>
</html>
```

### Custom Processors

Add custom analysis to reports:

```typescript
class CustomReportProcessor {
  async process(results: ComparisonResult[]): Promise<CustomSection> {
    // Analyze trends
    const trends = this.analyzeTrends(results);

    // Generate recommendations
    const recommendations = this.generateRecommendations(results);

    return {
      title: "Trend Analysis",
      content: {
        trends,
        recommendations,
        charts: await this.generateCharts(trends),
      },
    };
  }

  private analyzeTrends(results: ComparisonResult[]) {
    // Custom trend analysis logic
    return {
      averageChange: calculateAverage(results),
      trajectory: determineTrajectory(results),
      outliers: findOutliers(results),
    };
  }
}
```

## Report Interpretation

### Understanding Metrics

#### Difference Percentage

- **0-0.1%** - Negligible, likely sub-pixel differences
- **0.1-0.5%** - Minor differences, usually acceptable
- **0.5-2%** - Moderate differences, review needed
- **2-5%** - Significant differences, likely issues
- **>5%** - Major differences, definite problems

#### Confidence Scores

- **90-100%** - Very reliable classification
- **70-90%** - Reliable, minor uncertainty
- **50-70%** - Moderate confidence, review suggested
- **<50%** - Low confidence, manual review required

#### Severity Levels

- **Minor** - Cosmetic changes, low impact
- **Moderate** - Functional changes, medium impact
- **Major** - Breaking changes, high impact
- **Critical** - Severe issues, immediate attention

### Common Patterns

#### Style Drift

Multiple small style changes across components:

```json
{
  "pattern": "style-drift",
  "indicators": [
    "Multiple style changes with >80% confidence",
    "Consistent color/spacing modifications",
    "Low individual impact, high cumulative effect"
  ],
  "recommendation": "Review design system compliance"
}
```

#### Layout Shift

Positional changes affecting user experience:

```json
{
  "pattern": "layout-shift",
  "indicators": [
    "Multiple layout changes detected",
    "Content displacement >10px",
    "Affects interactive elements"
  ],
  "recommendation": "Test responsive behavior"
}
```

#### Content Updates

Expected content modifications:

```json
{
  "pattern": "content-update",
  "indicators": [
    "High-confidence content changes",
    "Localized to text regions",
    "No structural modifications"
  ],
  "recommendation": "Verify content accuracy"
}
```

## Report Actions

### Automated Actions

Configure automated actions based on reports:

```typescript
interface ReportAction {
  condition: (report: Report) => boolean;
  action: (report: Report) => Promise<void>;
}

const actions: ReportAction[] = [
  {
    // Fail CI on high differences
    condition: (report) => report.summary.failed > 0,
    action: async (report) => {
      console.error(`${report.summary.failed} visual regressions detected`);
      process.exit(1);
    },
  },
  {
    // Update baselines on minor changes
    condition: (report) => report.summary.averageDifference < 0.1 && report.summary.failed === 0,
    action: async (report) => {
      await updateBaselines(report.results);
    },
  },
  {
    // Send notifications on critical changes
    condition: (report) => report.changes.some((c) => c.severity === "critical"),
    action: async (report) => {
      await sendNotification({
        title: "Critical Visual Changes Detected",
        body: generateSummary(report),
      });
    },
  },
];
```

### Report Sharing

#### Export Options

```bash
# Export as PDF
aid report results/ --export pdf --output report.pdf

# Export as standalone HTML
aid report results/ --export standalone --output report.html

# Export data only
aid report results/ --export data --output report.zip
```

#### Sharing Methods

1. **CI Artifacts**

   ```yaml
   - name: Upload Report
     uses: actions/upload-artifact@v3
     with:
       name: visual-regression-report
       path: results/report.html
   ```

2. **Static Hosting**

   ```bash
   # Deploy to GitHub Pages
   gh-pages -d results/

   # Deploy to Netlify
   netlify deploy --dir=results/
   ```

3. **Email Integration**
   ```typescript
   await emailService.send({
     to: "team@example.com",
     subject: "Visual Regression Report",
     attachments: ["results/report.html", "results/summary.json"],
   });
   ```

## Best Practices

### 1. Report Retention

Establish retention policies:

```bash
# Keep reports for 30 days
find reports/ -mtime +30 -delete

# Archive important reports
tar -czf "report-$(date +%Y%m%d).tar.gz" results/
```

### 2. Report Naming

Use consistent naming conventions:

```
reports/
├── 2025-01-15-main-build-123.html
├── 2025-01-15-pr-456.html
└── 2025-01-15-release-v1.2.3.html
```

### 3. Report Analysis

Regular review process:

1. Daily summary reviews
2. Weekly trend analysis
3. Monthly retrospectives
4. Quarterly baseline updates

### 4. Integration

Integrate reports into workflows:

- Link from PR comments
- Include in release notes
- Dashboard integration
- Slack/Teams notifications

## Troubleshooting

### Report Generation Failures

```bash
# Debug report generation
aid report results/ --verbose --debug

# Validate input data
aid validate results/

# Generate minimal report
aid report results/ --minimal
```

### Large Reports

Handle reports with many comparisons:

```typescript
// Paginate large reports
const paginatedReport = await generator.generate({
  results: comparisonResults,
  pagination: {
    itemsPerPage: 50,
    currentPage: 1,
  },
});

// Generate summary-only report
const summaryReport = await generator.generateSummary({
  results: comparisonResults,
  includeDetails: false,
});
```

## See Also

- [CLI Usage](./CLI_USAGE.md) - Report generation commands
- [Batch Processing](./BATCH_PROCESSING.md) - Batch report features
- [CI Integration](./CI_INTEGRATION.md) - Reports in CI/CD
